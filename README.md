# pharma-email-assistant2
AI-powered email rewriting assistant for medical/pharma use cases.
![Architecture Diagram](Untitled-2025-12-11-1423.png)

## Roadmap (Upcoming Weeks)
- Audience-specific rewriting prompts
- Compliance checker agent
- Add hallucination evaluation
- Add Docker deployment to Azure
## System Architecture
![architecture](docs/architecture.png)
## How logging works
- Every request to the `/rewrite` endpoint is recorded using Loguru.
- Logs include: input text, audience type, output email, and timestamp.
- Sensitive data (names, IDs, emails) should be anonymized before saving.
- Logs are stored in `logs/requests.jsonl` for later review.

## How to submit feedback
- After testing a rewritten email, you can rate or comment on its quality.
- Feedback is captured via the `/feedback` endpoint (to be added in Week 3).
- Each feedback entry links to the original request and output.
- This helps identify strong examples for fine-tuning and weak ones to improve.

## How to export dataset for evaluation
- Logged requests and feedback can be exported into a dataset file.
- Example: run a script that reads `logs/requests.jsonl` and outputs `dataset.csv`.
- The dataset includes: input, audience, output, feedback, and compliance tags.
- This dataset is then used for evaluation or fine-tuning in Month 3.

- # Pharma Email Assistant

A FastAPI-based application that rewrites pharma-related emails using OpenAI models.  
Deployed on Azure App Service with Docker.

---

## üöÄ Live Demo
- API Docs: https://pharma-email-assistant-mofr-gzcfdrhwgrdqgdgd.westeurope-01.azurewebsites.net/docs

---

## üèóÔ∏è Deployment Architecture
- **Frontend**: Swagger UI (auto-generated by FastAPI)
- **Backend**: FastAPI app (`src/api/main.py`)
- **Containerization**: Docker (Python 3.10-slim base image)
- **Hosting**: Azure App Service (Linux, B1 plan)
- **Registry**: Docker Hub (`mofasshara/pharma-email-assistant:latest`)

Flow:
1. Code ‚Üí Docker build ‚Üí Push to Docker Hub  
2. Azure App Service pulls image ‚Üí Runs container on port 80  
3. Public endpoint exposed via `azurewebsites.net`

---

## üîë Environment Variable Setup
Configured in **Azure Portal ‚Üí Settings ‚Üí Environment Variables**:

| Name            | Value Example           | Purpose                          |
|-----------------|-------------------------|----------------------------------|
| `OPENAI_API_KEY`| `sk-xxxxxx`             | Authenticates with OpenAI API    |
| `OPENAI_MODEL`  | `gpt-4o-mini`           | Defines model used for rewriting |

Secrets are **never hardcoded** in code ‚Äî they are injected at runtime by Azure.

---

## ‚òÅÔ∏è Azure App Service Explanation
- **App Service Plan**: B1 (Basic, Linux) ‚Äî beginner-friendly, cost-effective  
- **Continuous Deployment**: Pulls latest Docker image from Docker Hub  
- **Scaling**: Can scale vertically (larger plan) or horizontally (multiple instances)  
- **Monitoring**: Log Stream + Health Check for uptime visibility  
- **Security**: Environment variables stored securely, HTTPS enabled by default  

---

## üìå Next Steps
- Add `/health` endpoint for monitoring  
- Configure CI/CD with GitHub Actions ‚Üí auto-build & push Docker image  
- Document usage examples in README (sample payloads for `/rewrite`)  

## üñºÔ∏è Screenshots

### Azure Web App overview
"C:\Users\mofas\OneDrive\Desktop\AI engineer\docs.azure-app-overview.png"

### Swagger UI (live)
"C:\Users\mofas\OneDrive\Desktop\AI engineer\fastapi.UI.png"

## Live Deployments (Azure)

- Agent Orchestrator API (FastAPI + LangChain):  
  https://pharma-email-assistant-mofr-gzcfdrhwgrdqgdgd.westeurope-01.azurewebsites.net/docs

- Rewrite Service API (FastAPI):  
  https://pharma-email-rewrite-mofr-gph0dueeegetf9gr.westeurope-01.azurewebsites.net/docs

### Architecture
Agent Orchestrator routes requests and calls downstream tool services via environment-configured URLs.

## Production Architecture

- Agent API (FastAPI) deployed on Azure App Service
- Rewrite LLM service deployed as separate App Service
- Agent orchestrates calls to rewrite service via HTTP
- Hardened with:
  - HTTPS normalization
  - Request timeouts
  - Clear error propagation
- Observability:
  - Azure Log Stream
  - Application Insights (Search, Failures)
  - Availability monitoring
    
## Reliability & Monitoring

- Health endpoints for all services
- Azure Application Insights for:
  - Request tracing
  - Failure analysis
- Availability tests with alerting enabled
- Defensive networking (timeouts, retries, URL validation)

